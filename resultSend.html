<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>é ç´„å®Œæˆ</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

<style>
  body {
    font-family: "Noto Sans TC", sans-serif;
    background: #f7f7f7;
    padding: 20px;
    margin: 0;
  }

  .card {
    background: #fff;
    padding: 20px;
    border-radius: 14px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.08);
    max-width: 480px;
    margin: 0 auto;
  }

  h2 {
    color: #06C755;
    font-size: 24px;
    margin-bottom: 12px;
    text-align: center;
  }

  .info {
    font-size: 16px;
    line-height: 1.8;
  }

  .footer {
    margin-top: 14px;
    color: #666;
    font-size: 14px;
    text-align: center;
  }

  .close-btn {
    margin-top: 20px;
    width: 100%;
    padding: 12px;
    background: #06C755;
    color: white;
    font-size: 18px;
    border-radius: 8px;
    border: none;
  }
</style>
</head>

<body>

<div id="page" class="card">
  <h2>é ç´„å®Œæˆ</h2>

  <div id="summary" class="info">è³‡æ–™è®€å–ä¸­...</div>

  <div class="footer">âœ” é ç´„æ‘˜è¦å·²å‚³é€è‡³æ‚¨çš„ LINE èŠå¤©å®¤</div>

  <button class="close-btn" onclick="liff.closeWindow()">é—œé–‰è¦–çª—</button>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbz2looN-W2dOY9RgJN2A327WOEs_bFfl18T1OaPvI1N7dYHPMdoLkHN9Y-3wuY4lkQm/exec"; // â† è¨˜å¾—æ›æˆä½ çš„

(async () => {
  await liff.init({
    liffId: "2008586106-kLrdO1gp",
    withLoginOnExternalBrowser: false
  });

  const url = new URL(window.location.href);

  /* ---- å–å¾—è³‡æ–™ ---- */
const data = {
  uid: url.searchParams.get("uid"),
  name: url.searchParams.get("name"),
  phone: url.searchParams.get("phone"),
  date: url.searchParams.get("date"),
  time: url.searchParams.get("time"),
  adult: url.searchParams.get("adult"),
  child: url.searchParams.get("child") || "0",
  seat: url.searchParams.get("seat") || "ç„¡",
  note: url.searchParams.get("note") || "ç„¡"
};


  /* ---- è£½ä½œè¨‚å–®ç·¨è™Ÿ ---- */
  const today = new Date();
  const sn = "B" +
    (today.getFullYear() - 2000).toString() +
    (today.getMonth() + 1).toString().padStart(2,"0") +
    today.getDate().toString().padStart(2,"0") +
    Math.floor(1000 + Math.random() * 9000);

  data.sn = sn;

  /* ---- å¯«å…¥è©¦ç®—è¡¨ ---- */
  try {
    await fetch(API_URL, {
      method: "POST",
      body: JSON.stringify(data)
    });
  } catch (e) {
    console.error("GAS éŒ¯èª¤:", e);
  }

  /* ---- é¡¯ç¤ºé ç´„æ‘˜è¦ ---- */
  document.getElementById("summary").innerHTML = `
    è¨‚å–®ç·¨è™Ÿï¼š${sn}<br>
    å§“åï¼š${data.name}<br>
    æ‰‹æ©Ÿï¼š${data.phone}<br>
    é ç´„æ—¥æœŸï¼š${data.date}<br>
    é ç´„æ™‚æ®µï¼š${data.time}<br>
    å¤§äººï¼š${data.adult} ä½<br>
    å°å­©ï¼š${data.child} ä½<br>
    å…’ç«¥æ¤…ï¼š${data.seat}<br>
    å‚™è¨»ï¼š${data.note}<br>
  `;

  /* ---- è‹¥ä¸åœ¨ LINEï¼Œå°±ä¸æ¨ Flex ---- */
  if (!liff.isInClient()) return;

  /* ---- Flex åœ–å¡ ---- */
  const flexMsg = {
  type: "flex",
  altText: "æ‚¨çš„é ç´„å·²é€å‡ºï¼",
  contents: {
    type: "bubble",
    size: "mega",
    body: {
      type: "box",
      layout: "vertical",
      spacing: "md",
      paddingAll: "20px",
      contents: [
        {
          type: "text",
          text: "é ç´„æˆåŠŸ",
          weight: "bold",
          size: "xl",
          color: "#06C755",
          margin: "md"
        },
        {
          type: "text",
          text: `${data.name} æ‚¨å¥½ï¼`,
          margin: "sm",
          size: "md",
          weight: "bold",
          color: "#333333"
        },
        {
          type: "separator",
          margin: "lg"
        },
        {
          type: "box",
          layout: "vertical",
          margin: "lg",
          spacing: "md",
          contents: [
            { type: "text", text: `ğŸ“… æ—¥æœŸï¼š${data.date}`, wrap: true },
            { type: "text", text: `â° æ™‚æ®µï¼š${data.time}`, wrap: true },
            { type: "text", text: `ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ å¤§äººï¼š${data.adult} ä½`, wrap: true },
            { type: "text", text: `ğŸ§’ å°å­©ï¼š${data.child || "0"} ä½`, wrap: true },
            { type: "text", text: `ğŸª‘ å…’ç«¥æ¤…ï¼š${data.seat || "ç„¡"}`, wrap: true },
            { type: "text", text: `ğŸ“± æ‰‹æ©Ÿï¼š${data.phone}`, wrap: true },
            { type: "text", text: `ğŸ“ å‚™è¨»ï¼š${data.note}`, wrap: true }
          ]
        },
        {
          type: "separator",
          margin: "lg"
        },
        {
          type: "text",
          text: "æˆ‘å€‘å·²æ”¶åˆ°æ‚¨çš„é ç´„ï¼Œå°‡ç›¡å¿«èˆ‡æ‚¨ç¢ºèªè¨‚ä½ï¼",
          color: "#888888",
          size: "sm",
          wrap: true,
          margin: "lg"
        }
      ]
    }
  }
};


  /* ---- æ¨ Flex å› LINE ---- */
  try {
    await liff.sendMessages([flex]);
  } catch (e) {
    console.error("Flex ç™¼é€å¤±æ•—:", e);
  }

})();
</script>

</body>
</html>
