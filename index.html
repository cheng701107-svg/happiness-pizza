<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>LINE é ç´„è¡¨å–®</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- LIFF -->
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

<!-- æ—¥æœŸå¥—ä»¶ flatpickr -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/zh-tw.js"></script>

<!-- å¤–éƒ¨ CSS -->
<link rel="stylesheet" href="style.css">

<style>
  .username {
    font-size: 20px;
    font-weight: 700;
    margin-bottom: 12px;
  }
  .username span {
    color: #06C755; /* LINE ç¶  */
  }
  .label-required {
    color: #d32f2f;
    margin-left: 4px;
  }
  .opening-note {
    font-size: 13px;
    color: #666;
    margin-top: 4px;
  }
</style>

</head>

<body>

<div class="container">

  <!-- é¡¯ç¤ºä½¿ç”¨è€…åç¨± -->
  <div class="username">ä½¿ç”¨è€… <span id="displayName">åç¨±</span> æ‚¨å¥½ï½</div>

  <h2>è«‹å¡«å¯«é ç´„è³‡è¨Š</h2>

  <form id="liffForm">

    <!-- éš±è— UID / email -->
    <input type="hidden" id="line_uid">
    <input type="hidden" id="line_email">
    <input type="hidden" id="name">

    <!-- æ‰‹æ©Ÿ -->
    <div class="field-group">
      <label>
        æ‰‹æ©Ÿè™Ÿç¢¼
        <span class="label-required">ï¼ˆå¿…å¡«ï¼‰</span>
      </label>
      <input type="tel" id="phone" required placeholder="0912345678"
        maxlength="10" pattern="09[0-9]{8}" inputmode="numeric">
    </div>

    <!-- é ç´„æ—¥æœŸ -->
    <div class="field-group date-group">
      <label>
        é ç´„æ—¥æœŸ
        <span class="label-required">ï¼ˆå¿…å¡«ï¼‰</span>
      </label>
      <input type="text" id="date" required placeholder="è«‹é¸æ“‡æ—¥æœŸ" readonly>
      <span class="date-icon">ğŸ“…</span>
      <div class="opening-note">ç‡Ÿæ¥­æ—¥ï¼šå…­æ—¥ & åœ‹å®šå‡æ—¥</div>
    </div>

    <!-- é ç´„æ™‚æ®µ -->
    <div class="field-group">
      <label>
        é ç´„æ™‚æ®µ
        <span class="label-required">ï¼ˆå¿…å¡«ï¼‰</span>
      </label>
      <select id="time" required>
        <option disabled selected>è«‹é¸æ“‡</option>
        <option value="11:30">11:30</option>
        <option value="13:30">13:30</option>
        <option value="15:30">15:30</option>
      </select>
    </div>

    <!-- å¤§äºº -->
    <div class="field-group">
      <label>
        å¤§äººäººæ•¸
        <span class="label-required">ï¼ˆå¿…å¡«ï¼‰</span>
      </label>
      <select id="adult" required>
        <option disabled selected>è«‹é¸æ“‡</option>
        <script>
          document.write(
            Array.from({length: 30}, (_, i) => i + 1)
              .map(n => `<option value="${n}">${n} ä½</option>`)
              .join("")
          );
        </script>
      </select>
    </div>

    <!-- å°å­©äººæ•¸ -->
    <div class="field-group">
      <label>
        å°å­©äººæ•¸
        <span class="label-required">ï¼ˆå¿…å¡«ï¼‰</span>
      </label>
      <select id="child" required>
        <option disabled selected>è«‹é¸æ“‡</option>
        <script>
          document.write(
            Array.from({length: 11}, (_, i) => i)
              .map(n => `<option value="${n}">${n === 0 ? "ç„¡" : n + " ä½"}</option>`)
              .join("")
          );
        </script>
      </select>
    </div>

    <!-- å…’ç«¥åæ¤… -->
    <div class="field-group">
      <label>å…’ç«¥åæ¤…</label>
      <select id="chair">
        <option value="0">ç„¡</option>
        <option value="1">1 å¼µ</option>
        <option value="2">2 å¼µ</option>
        <option value="3">3 å¼µ</option>
        <option value="4">4 å¼µ</option>
        <option value="5">5 å¼µ</option>
      </select>
    </div>

    <!-- å‚™è¨» -->
    <div class="field-group">
      <label>å‚™è¨»</label>
      <textarea id="note" rows="3" placeholder="å¯å¡«å¯«å‚™è¨»â€¦"></textarea>
    </div>

    <button type="submit">é€å‡ºè³‡æ–™</button>

  </form>
</div>

<script>
/* =======================================
   LIFF åˆå§‹åŒ–
======================================= */
async function initLIFF() {
  await liff.init({ liffId: "2008586106-kLrdO1gp" });

  if (!liff.isLoggedIn()) {
    liff.login({ redirectUri: window.location.href });
    return;
  }

  const profile = await liff.getProfile();
  const token = liff.getDecodedIDToken();

  document.getElementById("displayName").textContent = profile.displayName;
  document.getElementById("line_uid").value = profile.userId;
  document.getElementById("line_email").value = token?.email || "";
  document.getElementById("name").value = profile.displayName;
}

/* =======================================
   åœ‹å®šå‡æ—¥æ¸…å–®ï¼ˆå¯è‡ªè¡Œè£œå……ï¼‰
======================================= */
const holidays = [
  "2025-01-01",
  "2025-01-27", "2025-01-28", "2025-01-29", "2025-01-30",
  "2025-02-28",
  "2025-04-04", "2025-04-05",
  "2025-06-06",
  "2025-09-17",
  "2025-10-10"
];

/* =======================================
   æ—¥æœŸé¸æ“‡å™¨ï¼šåªå…è¨±å…­æ—¥ï¼‹åœ‹å®šå‡æ—¥
======================================= */
function initDatePicker() {
  flatpickr("#date", {
    locale: "zh_tw",
    dateFormat: "Y-m-d",
    minDate: "today",
    enable: [
      function(date) {
        const day = date.getDay();
        const ymd = date.toISOString().split("T")[0];
        return (day === 0 || day === 6 || holidays.includes(ymd));
      }
    ]
  });
}

/* =======================================
   DOM Ready
======================================= */
document.addEventListener("DOMContentLoaded", () => {
  initLIFF();
  initDatePicker();
});

/* =======================================
   é€å‡º â†’ resultSend.html
======================================= */
document.getElementById("liffForm").addEventListener("submit", function(e) {
  e.preventDefault();

  const params = new URLSearchParams();

  params.append("uid",   document.getElementById("line_uid").value);
  params.append("email", document.getElementById("line_email").value);
  params.append("name",  document.getElementById("name").value);
  params.append("phone", document.getElementById("phone").value);
  params.append("date",  document.getElementById("date").value);
  params.append("time",  document.getElementById("time").value);
  params.append("adult", document.getElementById("adult").value);
  params.append("child", document.getElementById("child").value);
  params.append("chair", document.getElementById("chair").value);
  params.append("note",  document.getElementById("note").value);

  window.location.href = "resultSend.html?" + params.toString();
});
</script>

</body>
</html>
