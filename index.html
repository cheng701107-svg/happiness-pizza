<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>LINE é è¨‚è¡¨å–®</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- LIFF -->
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

<!-- æ—¥æœŸå¥—ä»¶ flatpickrï¼ˆå½ˆå‡ºæœˆæ›†ï¼‰ -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/zh-tw.js"></script>

<!-- å¤–éƒ¨ CSS -->
<link rel="stylesheet" href="style.css">
</head>

<body>

<div class="container">
  <h2>è«‹å¡«å¯«ä»¥ä¸‹è³‡æ–™</h2>

  <form id="liffForm">

    <!-- éš±è—ï¼šUID / EMAIL -->
    <input type="hidden" id="line_uid">
    <input type="hidden" id="line_email">

    <!-- å§“åï¼ˆè‡ªå‹•å¸¶ LINE åç¨±ï¼Œå¯ä¿®æ”¹ï¼‰ -->
    <div class="field-group">
      <label>å§“å</label>
      <input type="text" id="name" placeholder="è«‹è¼¸å…¥å§“å">
    </div>


    <!-- é¤¨åˆ¥ -->
    <div class="field-group">
      <label>åŒ…æ£Ÿé¤¨åˆ¥</label>
      <select id="house">
        <option disabled selected>è«‹é¸æ“‡</option>
        <option value="Aæ£Ÿ">Aæ£Ÿ</option>
        <option value="Bæ£Ÿ">Bæ£Ÿ</option>
        <option value="çš†å¯">çš†å¯</option>
      </select>
    </div>

    <!-- æ—¥æœŸï¼šå½ˆå‡ºå¼æœˆæ›† -->
    <div class="field-group date-group">
  <label>
    <span class="label-title">åŒ…æ£Ÿæ—¥æœŸ</span>
    <span class="label-required">ï¼ˆå¿…å¡«ï¼‰</span>
  </label>
  <input
    type="text"
    id="date"
    required
    placeholder="è«‹é¸æ“‡æ—¥æœŸ"
    readonly
  >
  <span class="date-icon">ğŸ“…</span>
</div>


    <!-- å¤©æ•¸ -->
    <div class="field-group">
      <label>åŒ…æ£Ÿå¤©æ•¸</label>
      <select id="days">
        <option disabled selected>è«‹é¸æ“‡</option>
        <option value="1">1 æ™š</option>
        <option value="2">2 æ™š</option>
        <option value="3">3 æ™š</option>
      </select>
    </div>

    
      <div class="field-group">
       <label>
    <span class="label-title">å¤§äººäººæ•¸</span>
    <span class="label-required">ï¼ˆå¿…å¡«ï¼‰</span>
  </label>
      <select id="adult" required>
        <option value="" disabled selected>è«‹é¸æ“‡</option>
        <!-- è‡ªå‹•ç”Ÿæˆ 6â€“34 -->
        <script>
          document.write(
            Array.from({length: 29}, (_, i) => i + 6)
            .map(n => `<option value="${n}">${n} ä½</option>`)
            .join("")
          );
        </script>
      </select>
    </div>

    <!-- å°å­© -->
     <div class="field-group">
      <label>
    <span class="label-title">å°å­©äººæ•¸</span>
    <span class="label-required">ï¼ˆå¿…å¡«ï¼‰</span>
  </label>
      <select id="child" required>
        <option value="" disabled selected>è«‹é¸æ“‡</option>
        <script>
          document.write(
            Array.from({length: 11}, (_, i) => i)
              .map(n => `<option value="${n}">${n} ä½</option>`)
              .join("")
          );
        </script>
      </select>
    </div>


    <!-- å¯µç‰© -->
    <div class="field-group">
      <label>å¯µç‰©</label>
      <input type="text" id="pet" placeholder="ä¾‹å¦‚ï¼š1éš»å°ç‹—â€¦">
    </div>

    <!-- å‚™è¨» -->
    <div class="field-group">
      <label>éœ€æ±‚å…§å®¹</label>
      <textarea id="note" rows="3" placeholder="å¯å¡«å¯«å‚™è¨»ã€ç‰¹æ®Šéœ€æ±‚â€¦"></textarea>
    </div>

    <button type="submit">é€å‡ºè³‡æ–™</button>

  </form>
</div>

<script>
/* =======================================
   ğŸ”° LIFF åˆå§‹åŒ–ï¼ˆæŠ“ UID / Email / å§“åï¼‰
======================================= */
async function initLIFF() {
  await liff.init({ liffId: "2008409020-k4Oy7Y0D" });

  if (!liff.isLoggedIn()) {
    liff.login({ redirectUri: window.location.href });
    return;
  }

  // å–å¾—ä½¿ç”¨è€…åŸºæœ¬è³‡æ–™ï¼ˆåªå‘¼å«ä¸€æ¬¡ï¼‰
  const profile = await liff.getProfile();
  document.getElementById("line_uid").value = profile.userId;

  // è‡ªå‹•å¸¶å…¥ LINE é¡¯ç¤ºåç¨±
  const nameInput = document.getElementById("name");
  if (nameInput && !nameInput.value) {
    nameInput.value = profile.displayName || "";
  }

  // å–å¾— emailï¼ˆéœ€åœ¨ LINE Developers é–‹é€š email æ¬Šé™ï¼‰
  const token = liff.getDecodedIDToken();
  const email = token ? token.email : null;

  console.log("=== DEBUG ===");
  console.log("UID:", profile.userId);
  console.log("DisplayName:", profile.displayName);
  console.log("Email:", email);

  document.getElementById("line_email").value = email || "";
}

/* =======================================
   ğŸ“… åˆå§‹åŒ–æ—¥æœŸé¸æ“‡å™¨ flatpickr
======================================= */
function initDatePicker() {
  flatpickr("#date", {
    locale: "zh_tw",
    dateFormat: "Y-m-d",
    minDate: "today"
  });
}

/* =======================================
   ğŸš€ DOM è¼‰å…¥å¾ŒåŸ·è¡Œ
======================================= */
document.addEventListener("DOMContentLoaded", () => {
  initLIFF();
  initDatePicker();
});

/* =======================================
   ğŸ“¤ è¡¨å–®é€å‡º â†’ å°åˆ° resultSend.html
======================================= */
document.getElementById("liffForm").addEventListener("submit", function(e) {
  e.preventDefault();

  const params = new URLSearchParams();

  params.append("uid",   document.getElementById("line_uid").value);
  params.append("email", document.getElementById("line_email").value);

  // å§“ååª append ä¸€æ¬¡å°±å¥½
  params.append("name",  document.getElementById("name").value);
  params.append("house", document.getElementById("house").value);
  params.append("date",  document.getElementById("date").value);
  params.append("days",  document.getElementById("days").value);
  params.append("adult", document.getElementById("adult").value);
  params.append("child", document.getElementById("child").value);
  const petValue = document.getElementById("pet").value.trim() || "ç„¡";
  params.append("pet", petValue);
  params.append("note",  document.getElementById("note").value);
  window.location.href = "resultSend.html?" + params.toString();
});
</script>


</body>
</html>