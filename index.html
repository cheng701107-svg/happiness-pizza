<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<title>LINE é ç´„è¨‚ä½</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

<!-- æ—¥æœŸå¥—ä»¶ -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/zh-tw.js"></script>

<link rel="stylesheet" href="style.css">
</head>

<body>
<div class="container">

  <div class="username">
    <span id="displayName" class="green-name"></span> æ‚¨å¥½ï½
  </div>

  <h2>è«‹å¡«å¯«é ç´„è³‡è¨Š</h2>

  <!-- å§“åï¼ˆå¿…å¡«ï¼Œä½¿ç”¨è€…è‡ªè¡Œè¼¸å…¥ï¼‰ -->
<div class="field-group">
  <label>
    å§“å <span class="label-required">ï¼ˆå¿…å¡«ï¼‰</span>
  </label>
  <input type="text" id="name" required placeholder="è«‹è¼¸å…¥å§“å">
</div>

  <form id="liffForm">

    <input type="hidden" id="uid">
 
    <!-- æ‰‹æ©Ÿ -->
    <div class="field-group">
      <label>æ‰‹æ©Ÿè™Ÿç¢¼ <span class="label-required">ï¼ˆå¿…å¡«ï¼‰</span></label>
      <input type="tel" id="phone" required maxlength="10" pattern="09[0-9]{8}">
    </div>

    <!-- æ—¥æœŸ -->
    <div class="field-group date-group">
      <label>é ç´„æ—¥æœŸ <span class="label-required">ï¼ˆå¿…å¡«ï¼‰</span></label>
      <input type="text" id="date" required readonly>
      <span class="date-icon">ğŸ“…</span>
      <div class="hint">ï¼ˆç‡Ÿæ¥­æ—¥ï¼šå…­æ—¥èˆ‡åœ‹å®šå‡æ—¥ï¼‰</div>
    </div>

    <!-- æ™‚æ®µ -->
    <div class="field-group">
      <label>é ç´„æ™‚æ®µ <span class="label-required">ï¼ˆå¿…å¡«ï¼‰</span></label>
      <select id="time" required>
        <option disabled selected>è«‹é¸æ“‡</option>
        <option>11:30</option>
        <option>13:30</option>
        <option>15:30</option>
      </select>
    </div>

    <!-- å¤§äºº -->
    <div class="field-group">
      <label>å¤§äººäººæ•¸ <span class="label-required">ï¼ˆå¿…å¡«ï¼‰</span></label>
      <select id="adult" required>
        <option disabled selected>è«‹é¸æ“‡</option>
        <script>
          document.write(
            Array.from({length: 30}, (_, i) => i + 1)
              .map(n => `<option value="${n}">${n} ä½</option>`)
              .join("")
          );
        </script>
      </select>
    </div>

    <!-- å°å­© -->
    <div class="field-group">
      <label>å°å­©äººæ•¸</label>
      <select id="child">
        <option value="0">0 ä½</option>
        <script>
          document.write(
            Array.from({length: 10}, (_, i) => i + 1)
              .map(n => `<option value="${n}">${n} ä½</option>`)
              .join("")
          );
        </script>
      </select>
    </div>

    <!-- æ¤…å­ -->
    <div class="field-group">
      <label>å…’ç«¥åæ¤…</label>
      <select id="chair">
        <option value="0">0 å¼µ</option>
        <script>
          document.write(
            Array.from({length: 5}, (_, i) => i + 1)
              .map(n => `<option value="${n}">${n} å¼µ</option>`)
              .join("")
          );
        </script>
      </select>
    </div>

    <!-- å‚™è¨» -->
    <div class="field-group">
      <label>å‚™è¨»</label>
      <textarea id="note" rows="3" placeholder="å¯å¡«å¯«ç‰¹æ®Šéœ€æ±‚â€¦"></textarea>
    </div>

    <button type="submit">é€å‡ºé è¨‚</button>

  </form>
</div>

<script>
async function initLIFF() {
  await liff.init({ liffId: "2008586106-kLrdO1gp" });

  if (!liff.isLoggedIn()) {
    liff.login({ redirectUri: window.location.href });
    return;
  }

  const profile = await liff.getProfile();
  const token = liff.getDecodedIDToken();

  // è¨˜éŒ„ userId / email
  document.getElementById("line_uid").value = profile.userId;
  document.getElementById("line_email").value = token?.email || "";

  // ä¸å†è‡ªå‹•å¡«å§“åï¼Œåªé¡¯ç¤ºæ‰“æ‹›å‘¼
  document.getElementById("displayName").innerText = profile.displayName;
}


function initDatePicker() {
  flatpickr("#date", {
    locale: "zh_tw",
    dateFormat: "Y-m-d",
    minDate: "today"
  });
}

document.addEventListener("DOMContentLoaded", () => {
  initLIFF();
  initDatePicker();
});

document.getElementById("liffForm").addEventListener("submit", e => {
  e.preventDefault();

  const p = new URLSearchParams();

  p.append("uid", document.getElementById("uid").value);
  p.append("name", document.getElementById("name").value);
  p.append("phone", document.getElementById("phone").value);
  p.append("date", document.getElementById("date").value);
  p.append("time", document.getElementById("time").value);
  p.append("adult", document.getElementById("adult").value);

  p.append("child", document.getElementById("child").value || "0");
  p.append("chair", document.getElementById("chair").value || "0");
  p.append("note", document.getElementById("note").value || "ç„¡");

  location.href = "resultSend.html?" + p.toString();
});
</script>

</body>
</html>
